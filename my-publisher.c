#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <arpa/inet.h>
#include <netinet/in.h>
#include <string.h>

#define PORT 4801
#define ADDR "224.0.0.1"

uint8_t val_for_sensor_1[35] = 
	{0xf1,0x01,0x01,0x00,0x01,0x01,0x00,0x01,
	 0x51,0xC3,0x05,0x01,0x00,0x07,0x0b,0x33,
	 0x33,0x33,0x33,0x33,0x33,0x26,0x40,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00};

uint8_t val_for_sensor_2[35] =
	{0xf1,0x01,0x01,0x00,0x01,0x01,0x00,0x01,
	 0x52,0xC3,0x05,0x01,0x00,0x07,0x0b,0x33,
	 0x33,0x33,0x33,0x33,0x33,0x36,0x40,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00};

uint8_t val_for_all[66] = 
	{0xf1,0x01,0x01,0x00,0x01,0x01,0x00,0x02,
	 0x51,0xC3,0x52,0xC3,0x19,0x00,0x19,0x00,
	 0x05,0x01,0x00,0x07,0x0b,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,
	 0x05,0x01,0x00,0x07,0x0b,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	 0x00};

void main(void) {
	int sockfd;
	struct sockaddr_in addr;
	uint8_t *msg;
	int ret;

  sockfd = socket(AF_INET, SOCK_DGRAM, 0);

	addr.sin_family = AF_INET;
	addr.sin_port = htons(PORT);
	inet_pton(AF_INET,ADDR,&addr.sin_addr);

	while(1) {
		msg = val_for_sensor_1;
		printf("send data to sensor 1 \n");
		ret = sendto(sockfd,msg,35,0,(const struct sockaddr *)&addr,sizeof(addr));
		sleep(5);

		msg = val_for_sensor_2;
		printf("send data to sensor 2 \n");
		ret = sendto(sockfd,msg,35,0,(const struct sockaddr *)&addr,sizeof(addr));
		sleep(5);

		msg = val_for_all;
		printf("send data to two sensors\n");
		ret = sendto(sockfd,msg,66,0,(const struct sockaddr *)&addr,sizeof(addr));
		sleep(5);
	}
}
